# Введение

Данный пакет позволяет реализовать механизм управления упорядоченными задачами, 
исполнение которых отложено во времени.

Для инициализации менеджера отложенных задач необходимо выбрать один из 
доступных классов очередей или реализовать собственный. Класс очереди позволяет 
хранить информацию о порядке выполнения задач и времени их актуальности. Класс 
очереди должен реализовывать интерфейс _Queue\Queue_ и предоставлять возможность 
как добавлять новые задачи в очередь, так и исключать уже выполненные.

Класс _TaskManager_ предоставляет удобный интерфейс для регистрации новых задач, 
а так же метод `controll`, позволяющий выполнить все актуальные на указанный 
момент задачи.

```php
use Bricks\Deferred\Queue\ArrayQueue;
use Bricks\Deferred\Handler;
use Bricks\Deferred\TaskManager;

$queue = new ArrayQueue;
$manager = new TaskManager($queue);

class MyHandler implements Handler{
  public function handle($data = null){
    ... // Обработка задачи.
  }
}

// Регистрация новой задачи, исполнение которой планируется через 5 минут.
$manager->push(time() + 60 * 5, 'MyHandler');

sleep(time() + 60 * 5);

// Обработка актуальных задач.
$manager->controll();
```

В качестве обработчика задач может выступать любой класс, реализующий интерфейс 
_Handler_ и его метод `handle`, который и реализует логику обработки. Если 
создание обработчика задачи сложно, класс _TaskManager_ позволяет использовать 
специальный метод-фабрику, которая будет отвечать за это:

```php
...

$manager->handlerFactory(function($handlerName) use($serviceLocator){
  return $serviceLocator->get($handlerName);
});
```

Этот метод будет вызван для каждой обрабатываемой задачи и должен возвращать 
проинициализированный обработчик.

Если задача выбрасывает исключение, оно может быть перехвачено с помощью 
метода-обработчика:

```php
...

$manager->errorHandler(function(Exception $exception){
  ... // Обработка исключения.
});
```

Этот метод будет вызван для каждого перехваченного из обработчика исключения.
